{
  "metadata": {
    "experiment_id": "A",
    "experiment_name": "SPARC fit + Graph-origin justification",
    "date": "2025-12-19T08:56:58.670605",
    "version": "4.0"
  },
  "rsl_parameters": {
    "N": 512,
    "alpha": 2.0,
    "L": 3,
    "n_edges": 813,
    "avg_degree": 3.17578125
  },
  "sparc_data": {
    "n_galaxies": 171,
    "n_rar_points": 3367,
    "source": "SPARC Database (Lelli, McGaugh & Schombert 2016)"
  },
  "calibration": {
    "kappa_kpc_per_hop": 0.34285714285714286,
    "gamma_acceleration": 3.250859526715811e-09,
    "R_star_hops": 0,
    "r_star_kpc": 0.0,
    "method": "Anchor matching at r*"
  },
  "mu_curve": {
    "n_bins": 44,
    "n_raw_points": 3301,
    "x_range": [
      0.008354836249764226,
      35.41781146057589
    ],
    "template_used": "MOND: 1 - exp(-√x)",
    "E_mu": 0.029346760447438214,
    "E_mu_all_templates": {
      "MOND": 0.029346760447438214,
      "Standard": 0.1126288832709422,
      "Simple": 0.10615733889786064
    },
    "correlation": 0.9910495801645317,
    "binning_contract": {
      "x": [
        0.008354836249764226,
        0.010145965450552292,
        0.012321081089615108,
        0.014962503071465452,
        0.01817019923294788,
        0.02206556874796242,
        0.026796036627280518,
        0.0325406331979031,
        0.039516769724162674,
        0.047988466602214966,
        0.058276345533976905,
        0.07076976384652219,
        0.08594155019505281,
        0.1043658993401,
        0.12674010324862506,
        0.1539109409590486,
        0.18690672596683974,
        0.22697622400306372,
        0.2756359140966876,
        0.33472738157319515,
        0.4064870150975504,
        0.493630645531115,
        0.5994563298633001,
        0.7279691702012184,
        0.8840328917442539,
        1.073553916396884,
        1.303704898510162,
        1.5831961827346608,
        1.9226054576384366,
        2.334778081233291,
        2.835313229217179,
        3.443154264805988,
        4.1813056734210905,
        5.077703695500421,
        6.166273607593786,
        7.488213665835109,
        9.093554304198433,
        11.043051597297564,
        13.410486648138589,
        16.285457923959513,
        19.776772219512885,
        24.016562582933048,
        29.165289052115433,
        35.41781146057589
      ],
      "mu": [
        0.07343458264041011,
        0.1073385905630854,
        0.10481008035062093,
        0.10131426100039898,
        0.13947990268101895,
        0.13870434106923762,
        0.16417065131281122,
        0.18003168305572226,
        0.18780031619870063,
        0.20622422498411136,
        0.22443541666666672,
        0.23632137278106508,
        0.2546435009915269,
        0.26461821651858053,
        0.2893654802966943,
        0.33293348998655015,
        0.33408345804276196,
        0.34456558715397917,
        0.37937451522416377,
        0.4050795487244898,
        0.43188715867768585,
        0.4953100222784491,
        0.5370198688955672,
        0.5526496766584598,
        0.565438574199548,
        0.5905815744687718,
        0.6178838346354167,
        0.6706517322371441,
        0.7103296362945338,
        0.7255440484891161,
        0.703182201570261,
        0.8088394965738258,
        0.858540370170062,
        0.9147254945991574,
        0.8967996987662233,
        0.9187782945900251,
        0.9719771248739894,
        0.9838356256507599,
        1.0092621205416359,
        0.9874262192655676,
        0.9434884203061393,
        0.9226737444732794,
        0.9885751711902102,
        0.7552923868981687
      ],
      "mu_std": [
        0.33004496693307017,
        0.10919980539546754,
        0.1485446635285046,
        0.06868715526451356,
        0.12643022782854083,
        0.1526032615870192,
        0.1759226547658793,
        0.18652904056374153,
        0.13537347619006848,
        0.1188851950201889,
        0.16780957503657382,
        0.16738688043627903,
        0.1947120201313038,
        0.14277116559591338,
        0.12455974301147428,
        0.10550466248032735,
        0.09754115475639223,
        0.1657077190489282,
        0.1622559193077433,
        0.16718291260245158,
        0.1538072147678113,
        0.12777611590993965,
        0.14111843691725062,
        0.15850043195644434,
        0.2391413758515568,
        0.21178656699028295,
        0.2176520750148446,
        0.1997669698145835,
        0.16684658768081131,
        0.199290914187139,
        0.1484739569245466,
        0.15421412529408768,
        0.1801207433976492,
        0.1729209686583956,
        0.15848717535249165,
        0.17532125515723854,
        0.24905202119456196,
        0.18780873532966147,
        0.1826021189105293,
        0.1809305363409452,
        0.23477174794975425,
        0.3051081348138601,
        0.25936865779255025,
        0.2764933321737805
      ],
      "n_per_bin": [
        6.0,
        10.0,
        7.0,
        23.0,
        40.0,
        64.0,
        81.0,
        130.0,
        142.0,
        171.0,
        181.0,
        185.0,
        197.0,
        160.0,
        125.0,
        130.0,
        96.0,
        101.0,
        104.0,
        109.0,
        107.0,
        99.0,
        96.0,
        97.0,
        112.0,
        76.0,
        81.0,
        69.0,
        63.0,
        55.0,
        51.0,
        52.0,
        47.0,
        34.0,
        41.0,
        31.0,
        28.0,
        18.0,
        16.0,
        14.0,
        13.0,
        13.0,
        10.0,
        6.0
      ],
      "log_x_range": [
        -2.3733060861744972,
        1.8444657502860058
      ],
      "n_bins_requested": 50,
      "n_bins_actual": 44,
      "min_points_per_bin": 5,
      "aggregator": "median"
    },
    "binning_stability": {
      "30": {
        "n_bins_actual": 27,
        "E_mu": 0.026574750144582007
      },
      "44": {
        "n_bins_actual": 39,
        "E_mu": 0.029798901894049382
      },
      "50": {
        "n_bins_actual": 44,
        "E_mu": 0.029346760447438214
      },
      "60": {
        "n_bins_actual": 52,
        "E_mu": 0.0269417720562183
      }
    },
    "binning_is_stable": true
  },
  "rar_metrics": {
    "sigma_rar_dex": 0.19431473386397774,
    "sigma_rar_uncertainty": 0.004818680761655567,
    "ci_95": [
      0.18526021090319184,
      0.20417856496239464
    ],
    "n_points": 3367,
    "threshold": 0.2,
    "hit": true,
    "p_hit_bootstrap": 88.9,
    "definition": {
      "g_obs": "v_obs^2 / r",
      "g_bar": "v_bar^2 / r",
      "g_pred": "g_bar / mu(g_bar/a0), mu=1-exp(-sqrt(x))",
      "scatter_dex": "std(log10(g_obs) - log10(g_pred))"
    },
    "bootstrap_confidence": {
      "pass_probability": 0.889,
      "ci_upper_crosses_threshold": true,
      "interpretation": "single-run pass",
      "strict_pass_95": false
    },
    "bootstrap_is_gating": false,
    "bootstrap_note": "Bootstrap provides uncertainty; HIT based on point estimate only"
  },
  "target_spec": {
    "hit": true,
    "score": 0.6626262271152071,
    "hit_rotation": true,
    "hit_rar": true,
    "hit_mu": true,
    "metrics": {
      "f_good": 0.543859649122807,
      "chi2_median": 4.383720286143104,
      "sigma_rar": 0.19431473386397774,
      "E_mu": 0.029346760447438214
    },
    "thresholds": {
      "f_good": 0.5,
      "scatter_dex": 0.2,
      "E_mu": 0.1
    },
    "score_mapping": {
      "s_rar_formula": "clip((0.20 - σ)/(0.20 - 0.12), 0, 1)",
      "sigma_ideal": 0.12,
      "sigma_threshold": 0.2
    },
    "gating_checks": [
      "sigma_rar",
      "f_good",
      "E_mu"
    ],
    "non_gating_checks": [
      "graph_origin.validation",
      "bootstrap_confidence",
      "kappa_stability"
    ],
    "recompute_contract": {
      "f_good": {
        "table": "tables/galaxy_fit_summary.parquet",
        "formula": "mean(chi2_red < chi2_red_threshold)",
        "params": {
          "chi2_red_threshold": 5.0
        }
      },
      "sigma_rar_dex": {
        "table": "tables/rar_points.parquet",
        "formula": "std(log10(g_obs) - log10(g_pred))",
        "params": {
          "ddof": 1
        }
      },
      "E_mu": {
        "table": "tables/mu_curve.csv",
        "formula": "mean(abs(mu_graph - mu_template_mond))",
        "params": {
          "template": "mu=1-exp(-sqrt(x))",
          "weighting": "uniform_in_logx",
          "binning": {
            "n_bins": 50,
            "aggregator": "median",
            "min_points": 5,
            "spacing": "log10(x) uniform"
          }
        }
      }
    }
  },
  "a0_universality": {
    "a0_median": 2.5001880951967384e-11,
    "sigma_log_a0_all": 2.4598683167279334,
    "scatter_decomposition": {
      "sigma_all": 2.4598683167279334,
      "sigma_good_fits": 0.4173787673325101,
      "sigma_trimmed_10_90": 0.19678388988338655,
      "n_outliers": 32,
      "f_outliers_percent": 18.71345029239766,
      "outlier_threshold_dex": 0.3935677797667731,
      "interpretation": "Приемлемый scatter; outliers вносят основной вклад в полный σ"
    }
  },
  "stability": {
    "kappa_factors_tested": [
      0.95,
      1.0,
      1.05
    ],
    "n_hits": 3,
    "is_robust": true,
    "details": [
      {
        "factor": 0.95,
        "kappa": 0.3257142857142857,
        "sigma_rar": 0.19421570667875857,
        "E_mu": 0.035861120809233586,
        "hit_all": true
      },
      {
        "factor": 1.0,
        "kappa": 0.34285714285714286,
        "sigma_rar": 0.19431473386397774,
        "E_mu": 0.029346760447438214,
        "hit_all": true
      },
      {
        "factor": 1.05,
        "kappa": 0.36000000000000004,
        "sigma_rar": 0.19452230581469412,
        "E_mu": 0.025832092606370406,
        "hit_all": true
      }
    ]
  },
  "graph_origin": {
    "profiles": {
      "file_npz": "experiment_A_graph_profiles.npz",
      "file_json": "experiment_A_graph_profiles.json",
      "fields": [
        "r",
        "A_boundary",
        "g_eff",
        "g_newton",
        "delta",
        "delta_raw",
        "D_surf",
        "mu"
      ]
    },
    "definitions": {
      "delta": "g_eff/g_newton - 1 (clipped to > -1 for positive mu)",
      "delta_raw": "g_eff/g_newton - 1 (before clipping)",
      "mu_from_delta": "1/(1+delta), with mu ∈ (0, 1]",
      "D_surf": "d(log A)/d(log r) + 1 via rolling linear fit (window=7)"
    },
    "validation": {
      "checks": [
        {
          "id": "A_boundary_positive",
          "description": "A(r) must be positive for all r",
          "passed": true,
          "actual": "min(A) = 2.0"
        },
        {
          "id": "g_newton_positive",
          "description": "g_newton must be positive",
          "passed": true,
          "actual": "min(g_newton) = 3.0297e-03"
        },
        {
          "id": "mu_in_0_1",
          "description": "mu(delta) should lie in (0,1]",
          "passed": true,
          "actual": "mu range: [0.0020, 0.9990]",
          "severity": "warn"
        },
        {
          "id": "delta_gt_minus1",
          "description": "delta should be > -1 if g_eff is magnitude",
          "passed": true,
          "actual": "min(delta) = 0.0010",
          "severity": "warn"
        },
        {
          "id": "D_surf_reasonable",
          "description": "D_surf shouldn't blow up due to numeric derivative",
          "passed": false,
          "actual": "95th percentile |D_surf| = 11.69",
          "severity": "warn",
          "D_surf_p95_abs": 11.693108210327757,
          "D_surf_max_abs": 16.19303387424845,
          "n_violations": 7,
          "r_violations": [
            48,
            49,
            65,
            66,
            70,
            82,
            85
          ]
        }
      ],
      "warnings": [
        "D_surf_reasonable"
      ],
      "pass": true,
      "notes": "Warnings allowed in v3/v4; validation extended with confidence mask.",
      "D_surf_stats": {
        "p95_abs": 11.693108210327757,
        "max_abs": 16.19303387424845,
        "n_violations": 7
      },
      "confidence_mask": {
        "n_trusted": 79,
        "f_trusted_percent": 91.86046511627907,
        "r_trusted_range": [
          1.0,
          86.0
        ]
      }
    },
    "validation_is_gating": false,
    "validation_note": "Graph-origin validation is diagnostic only; HIT is determined by SPARC metrics (σ_RAR, E_μ, f_good)"
  },
  "artifacts_manifest": {
    "base_dir": "/home/catman/Yandex.Disk/cuckoo/z/reals/libs/Experiments/Space/World/data/sparc",
    "generated_at": "2025-12-19T08:56:58.665247",
    "files": [
      {
        "name": "tables/rar_points.parquet",
        "role": "ci_metric_input",
        "sha256": "754d3756df1d9b37a3910ee41c25c703fc0f3351e42bafcbe312ed858ce4c49c",
        "n_rows": 3367
      },
      {
        "name": "tables/galaxy_fit_summary.parquet",
        "role": "ci_metric_input",
        "sha256": "ba0fe4aedd5aca9518bc66f761e8f5534d647a7f0cfbc096dc6bab3e4c3fd828",
        "n_rows": 171
      },
      {
        "name": "tables/mu_curve.csv",
        "role": "ci_metric_input",
        "sha256": "02c073521091fa0402f690db47c4f1167c930599b13892b91c3874a8485f3912",
        "n_rows": 44
      },
      {
        "name": "experiment_A_graph_profiles.npz",
        "role": "graph_profiles",
        "sha256": "34a3a1d0a6331b5367c99bdeb2d3034792e53da3115be7a0f62d3b2a5de9811b"
      },
      {
        "name": "experiment_A_graph_profiles.json",
        "role": "graph_profiles",
        "sha256": "f5e7a05f76bdc2b34f1e17ca4d9bbcd7f5a3593e50e248d04fa557719816282b"
      },
      {
        "name": "experiment_A_mu_curve.npz",
        "role": "mu_curve_data",
        "sha256": "468fd07dc7b2653b8e1e36d66cbeae9ffed3f1c8df594e804a2546c9d9db10f1"
      },
      {
        "name": "experiment_A_mu_curve.json",
        "role": "mu_curve_data",
        "sha256": "72d3cf6fd6d2ceec61020dc2cbaebfaa4ba4d4ffec9698e29569898f04551b15"
      },
      {
        "name": "experiment_A_report_v4.json",
        "role": "report",
        "sha256": "a1ecb7cffb2c1907ef2130f8cc7af9108457a704f8d2c0017d8b4044387849e6"
      }
    ]
  },
  "conclusions": {
    "main": "RSL граф с α=2.0 предсказывает форму μ(x), близкую к MOND",
    "key_results": [
      "a₀ = 1.05e-10 м/с² (SPARC)",
      "σ_RAR = 0.1943 ± 0.0048 dex",
      "E_μ = 0.0293 (MOND template best)",
      "f_good = 54.39%"
    ],
    "novelty": [
      "Потоковый расчёт g_eff без артефактов биннинга",
      "Калибровка единиц через один якорный матчинг",
      "Извлечение μ(x) напрямую из SPARC данных",
      "Bootstrap оценка неопределённости σ_RAR",
      "Проверка стабильности при вариации κ ±5%",
      "Робастный расчёт D_surf через скользящий фит (v3.1)",
      "Валидация graph-origin профилей (v3.1)"
    ],
    "red_flags_fixed_v3": [
      "D_surf: заменён np.gradient на rolling linear fit — устранены экстремальные значения",
      "delta: нормализован для гарантии mu ∈ (0, 1]",
      "Добавлена валидация graph_origin профилей"
    ],
    "v4_improvements": [
      "SCORE маппинг σ_RAR: линейная интерполяция 0.12-0.20 dex вместо threshold/σ",
      "E_μ контракт биннинга: n_bins=50, aggregator=median, min_points=5",
      "E_μ стабильность биннинга: проверка при 30/44/50/60 бинах",
      "Bootstrap помечен как диагностический (is_gating=False)",
      "σ(log a₀) разложение: all/good_fits/trimmed/outliers",
      "D_surf validation расширена: p95_abs, max_abs, confidence_mask"
    ],
    "v5_improvements": [
      "delta_raw и delta_clipped сохранены отдельно для прозрачности клиппинга",
      "fraction_clipped и r_range_clipped добавлены в profiles_json",
      "E_mu_contract полностью задокументирован (definition, template, x_filter, weighting)",
      "graph_origin.validation_is_gating=False явно помечен как диагностический"
    ]
  }
}
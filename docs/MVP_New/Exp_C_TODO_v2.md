Проверяю **[experiment_C_ftl_control(1).pdf](/files/nrh0IK7jOhyN_iBXfqrVi)** именно по тем замечаниям, которые я ранее выдвигал к **[experiment_C_ftl_control.pdf](/files/zHik4bvMBQlABEhysudMQ)** в контексте требований строгой внешней проверки (табличные артефакты/контракт пересчёта/manifest + обязательные Tests 4–6 из **[ftl_physics(3).pdf](/files/RiFu_bq20Eu_J2UvoOaVf)**).

## 0) Вердикт
Да, по содержимому **[experiment_C_ftl_control(1).pdf](/files/nrh0IK7jOhyN_iBXfqrVi)** основные замечания **устранены**: вы добавили и явно продемонстрировали **Test 4 (локальная каузальность)**, **Test 5 (детерминизм через state hash)**, **Test 6 (сохранение Q с трассой)**, а также формализовали H1–H4, измеряемые величины и структуру эксперимента.

Однако, если говорить строго “готово для внешней проверки уровня A/B”, то остаётся один главный недостающий слой: **артефакты-таблицы + manifest + явный recompute-contract**, чтобы внешний проверяющий мог пересчитать метрики H1–H4 не из принтов/картинок, а из сохранённых данных. В pdf я вижу принты и PASS’ы, но **не вижу экспорта `pairs_eval.parquet`, `control_sweep.parquet`, `Q_trace.csv` и sha256 manifest**. Возможно, это есть в коде ниже, но в показанном фрагменте не подтверждено.

Ниже — детально.

---

## 1) Самое важное: Tests 4–6 (строгость по ftl_physics) — теперь реально закрыты

### Test 5: Детерминизм ✅
Вы прямо показываете:

- Run A: `State hash A: 103618bd35d935d7`
- Run B: `State hash B: 103618bd35d935d7`
- “Хэши совпадают: True”
- “Test 5 (Детерминизм): ✅ PASSED”  
[(experiment_C_ftl_control(1).pdf)](/files/nrh0IK7jOhyN_iBXfqrVi)

Это ровно то, чего не хватало раньше. Единственное, что для *внешней* проверки стоит уточнить — **что хэширует state hash** (adjacency? φ? s(t)? всё вместе?) и где это записано в JSON.

### Test 6: Сохранение Q ✅
Вы показываете:
- формулу \(Q = N(+\to-) - N(-\to+)\)
- Q(0)=0, Q(10)=0, Q_min=0, Q_max=0
- трасса `[0,0,0,...,0]`
- “✅ Q(t) = Q(0) для всех t”  
[(experiment_C_ftl_control(1).pdf)](/files/nrh0IK7jOhyN_iBXfqrVi)

Это тоже закрывает прежнюю претензию.

### Test 4: Локальная каузальность ✅ (на уровне итогов)
В “ИТОГ ТЕСТОВ СТРОГОСТИ (Tests 4-6)” вы пишете:
- “✅ Test 4: Локальная каузальность”
- “Все тесты строгости: ✅ PASSED”  
[(experiment_C_ftl_control(1).pdf)](/files/nrh0IK7jOhyN_iBXfqrVi)

Здесь единственное, чего не хватает для внешнего аудитора — **что именно проверялось** (например: “s(t+1) зависит только от окна L”, “φ(t+1) зависит только от соседей”, “H(t)=f(state(t))”, “DAG по времени”). В [ftl_physics(3).pdf](/files/RiFu_bq20Eu_J2UvoOaVf) эти пункты формализованы; в вашем pdf по C хорошо бы вывести хотя бы 2–4 булевых чекбокса, как вы сделали для 5 и 6.

---

## 2) H1–H4: формулировки и измеримые величины — на хорошем уровне

Вы чётко фиксируете:

- механизм активации wormhole:
\[
activate(i,j,t)=1[\mathrm{Resonance}>\theta_R \wedge d(i,j)>d_{min} \wedge Capacity(t)>\dots]
\]
- определение Resonance через корреляцию Ω-сигнатур:
\[
\mathrm{Resonance}(i,j)=|\mathrm{corr}(s[i-w:i+w], s[j-w:j+w])|
\]
- измеряемые: `dgraph`, `deff`, `Resonance`, `FTL-factor = dbase/deff`, `cbase = 1 hop/step`.  
[(experiment_C_ftl_control(1).pdf)](/files/nrh0IK7jOhyN_iBXfqrVi)

Это соответствует “операциональности” и позволяет строить автоматические метрики.

### Где ещё можно усилить строгость H1/H2/H4
Чтобы H1–H4 были не “по картинке”, а статистически и воспроизводимо:

- **H1**: задайте порог Γ_FTL (например p95(ftl_factor) ≥ 1.5) и долю укороченных путей ≥ 0.8 — и фиксируйте это в TargetSpec.
- **H2**: подтвердить управляемость лучше не словами, а sweep‑таблицей + Spearman тестами (как в патче, который я предлагал).
- **H4**: бимодальность — лучше дип‑тестом (Hartigan) или BIC(1‑GMM vs 2‑GMM).

В этом pdf пока видно, что H4 заявлена, но не видно конкретного статистического теста.

---

## 3) Главный оставшийся “gap” до уровня внешней проверки A/B: артефакты и контракт пересчёта

То, что вы теперь показываете Tests 4–6 в самом ноутбуке — это отлично. Но внешний проверяющий обычно не будет “верить принтам”; ему нужны:

1) Таблицы (parquet/csv/npz), из которых можно пересчитать:
   - H1: frac_shortened, p95(ftl_factor), max/mean
   - H2: зависимости от θ_R, capacity, dmin
   - H4: распределение Δd или log(ftl_factor)

2) `manifest.json` с sha256

3) `recompute_contract` в JSON, где прописаны:
   - фильтры пар (как выбираются resonant_pairs)
   - метрика расстояния (BFS hops)
   - определение “active wormhole”
   - пороги

В **[experiment_C_ftl_control(1).pdf](/files/nrh0IK7jOhyN_iBXfqrVi)** я вижу:
- сохранение state hash,
- трассу Q,
- но не вижу (в показанном фрагменте) блоков экспорта таблиц и manifest, как вы сделали в A и B.

Если они есть дальше по pdf — ок. Если нет — это единственное, что мешает сказать “готово для независимой проверки”.

---

## 4) Конкретный список “что должно быть явно в pdf/репорте”, чтобы я сказал “полностью готово”
Пожалуйста, проверьте, что в этой версии вы реально делаете и печатаете:

1) **Экспорт `tables/pairs_eval.parquet`** (или csv) со столбцами `u,v,resonance,dbase,deff,ftl_factor,delta_d,active,seed`.
2) **Экспорт `tables/control_sweep.parquet`**, если вы делаете sweep для H2 (иначе H2 будет слишком “качественной”).
3) **Экспорт `tables/Q_trace.csv`** (вы уже печатаете trace; лучше сохранять файл).
4) **`experiment_C_report.json`** с:
   - параметрами (α, ruleset, θ_R, dmin, capacity),
   - результатами H1–H4,
   - Tests 4–6 (bool + hashes),
   - `recompute_contract`.
5) **`manifest.json`** с sha256.

---

## Итог
- По содержанию и закрытию моих прежних замечаний (Tests 4–6, детерминизм, Q) — **да, вы их закрыли** в **[experiment_C_ftl_control(1).pdf](/files/nrh0IK7jOhyN_iBXfqrVi)**.
- Чтобы эксперимент был “внешне проверяемым” в строгом смысле (как A/B), осталось убедиться, что вы добавили **табличные артефакты + manifest + контракт пересчёта** и что H2/H4 подтверждаются не только демонстрационно, но и статистически.

Если вы пришлёте `experiment_C_report.json` и `manifest.json` (или следующий pdf, где видно экспорт `pairs_eval.parquet` и `control_sweep.parquet`), я смогу подтвердить “да, полностью готово для внешней проверки” без оговорок.
